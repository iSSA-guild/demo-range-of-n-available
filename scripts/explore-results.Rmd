---
output: github_document
always_allow_html: true
---

# `targets` workflow for iSSA with `amt`

```{r, results = 'hide', echo = FALSE}
targets::tar_visnetwork(TRUE)
```

iSSAs are created on an individual basis. Previous vignettes have looped through individuals, used `lapply()`, or have been mapped in a piping framework. When using these, we've frequently run into a single individual breaking the whole process, so they must be removed. Then we restart. This has led us to try a new, more efficient (?) framework with `targets`. The `targets` package creates a workflow that sets up parallel computing, breaking up analyses a "target". In the case of iSSA, this would be the individual. Thus, we can calculate things like tracks, random steps, and covariate extractions by individual in a way the reduces repeated computation burdens. This framework allows us to integrate other variables we may want to group by for analysis such as year or season in a simple way without having to redo a lot of work; you just add another target

## R setup

```{r, eval = FALSE}
options(repos = c(
    ropensci = 'https://ropensci.r-universe.dev',
    tidyverse = 'https://tidyverse.r-universe.dev',
    rspatial = 'https://rspatial.r-universe.dev',
    CRAN = 'https://cloud.r-project.org'))

install.packages(c('data.table', 'amt', 'sf', 'ggplot2', 'raster', 'qs', 'terra' ))
```

## Data setup

Run through `scripts/prep-fisher.R`.


## Explore results

See `scripts/explore-results.R` for a full example. 

Below is an example of how to interact with `targets` outputs - but don't run them in this README. Copy over to a separate R script or check out the explore results script. 

```{r, eval = FALSE}
library(targets)

## Run the full workflow
tar_make()

## Inspect output with tar_read or tar_load
# *Read* one branch (individual in this case)
tar_read(tracks, 1)
tar_read(tracks, 2)

# Or all combined
tar_read(tracks)

# Plot all distributions
tar_read(distributions)

# *Load* all random steps and extracted landscape variables
tar_load(mergelc)
```
